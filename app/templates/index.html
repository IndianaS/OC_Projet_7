<!DOCTYPE html>
<html>
    <head>
        <!-- En-tête de la page -->
        <meta charset="utf-8" />
        <link href="https://fonts.googleapis.com/css?family=Indie+Flower&display=swap" rel="stylesheet">
        <link rel="stylesheet" href={{ url_for('static', filename='style.css') }}/>
        <title>GrandPy Bot</title>
    </head>

    <body>
            <div class="div">
                <h1>GrandPy vous souhaite la bienvenue</h1>
            </div>
        <br>
        <form id="user-text-form">
           <p>
             <label from="userText"></label>
             <input type="text" id="userText" class="input-usertext" name="userText" placeholder="Pausé une question au grand sage...">
             <br>
             <br>
             <input type="submit" value="Envoyé">
           </p> 
        </form>
        <div id="chatbox" class="chatbox"></div>
        <script>
            let form = document.querySelector("#user-text-form")

            function createDiv(text, klass, parent) {
                let divElt = document.createElement("div");
                divElt.classList.add(klass);
                divElt.textContent = text;
                parent.appendChild(divElt);
                divElt.scrollIntoView();
                }

            function createDivLink(url, klass, parent) {
                let divElt = document.createElement("div");
                divElt.classList.add(klass);
                divElt.innerHTML = "Lien vers page Wikipedia".link(url);
                parent.appendChild(divElt);
                divElt.scrollIntoView();
                }


            function createMap(position, klass, parent) {
                let mapElt = document.createElement("div");
                mapElt.classList.add(klass);
                console.log(position);
                let map = new google.maps.Map(mapElt, {
                zoom: 6,
                center: position
                });

            var marker = new google.maps.Marker({
                position: position,
                map: map,
                title: "Voilà l'endroit demandé"
                });
                parent.appendChild(mapElt);
                }

           form.addEventListener("submit", function (event) {
               event.preventDefault();
               fetch("/ajax", {
                   method: "Post",
                   body: new FormData(form)
               }).then(function(response) {
                   return response.json()
                    }).then(function(data) {
                        console.log(data)
                        let chatbox = document.querySelector("#chatbox")
                        createDiv(data.question, "question", chatbox);
                        createDiv(data.adress, "answer", chatbox);
                        createDivLink(data.url, "answer", chatbox);
                        createMap(data.coords, "map", chatbox);
                        createDiv(data.article, "answer", chatbox);
                        });
           })


        </script>
        <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWLa9kNqrKKKE8jMU1xpXYzPOHpxvpHuQ">
        </script>
    </body>
</html>


